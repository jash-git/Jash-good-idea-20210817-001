var sfdcURL="https://natinst.my.salesforce.com";var sfdcCommunityURL="https://natinst.force.com/nichatbot";var sfdcEmbeddedId="00Di0000000jTAB";var sfdcBaseLiveAgentContentURL="https://c.la1-c1-ia4.salesforceliveagent.com/content";var sfdcBaseLiveAgentURL="https://d.la1-c1-ia4.salesforceliveagent.com/chat";var sfdcEmbeddedServiceSourceURL="https://natinst.my.salesforce.com/embeddedservice/5.0/esw.min.js";var sfdcEmbeddedDeploymentName;var sfdcDeploymentId;var sfdcButtonId;var sfdcEswLiveAgentDevName;var environment="";var hostNameVar=location.hostname;if(hostNameVar.includes("-dev")){sfdcURL="https://natinst--dev2.my.salesforce.com";sfdcCommunityURL="https://dev2-natinst.cs29.force.com/nichatbot";sfdcEmbeddedId="00D0r0000008az4";sfdcBaseLiveAgentContentURL="https://c.la3-c1cs-ia2.salesforceliveagent.com/content";sfdcBaseLiveAgentURL="https://d.la3-c1cs-ia2.salesforceliveagent.com/chat";sfdcEmbeddedServiceSourceURL="https://natinst--dev2.my.salesforce.com/embeddedservice/5.0/esw.min.js";environment="-dev2"}else if(hostNameVar.includes("-test")){sfdcURL="https://natinst--test2.my.salesforce.com";sfdcCommunityURL="https://test2-natinst.cs29.force.com/nichatbot";sfdcEmbeddedId="00D0r0000000lAA";sfdcBaseLiveAgentContentURL="https://c.la3-c1cs-ia2.salesforceliveagent.com/content";sfdcBaseLiveAgentURL="https://d.la3-c1cs-ia2.salesforceliveagent.com/chat";sfdcEmbeddedServiceSourceURL="https://natinst--test2.my.salesforce.com/embeddedservice/5.0/esw.min.js";environment="-test2"}var botLocation=window.location.pathname.toLowerCase();var chatbotButton;var chatbotPageLocale="";var chatbotNIUA=NIUA.getNIUA({apikey:"f9dfab7b-3360-49c9-bf0d-0b52b01fc3da"});var chatHasEnded=false;var chatLoadedFromCookie=false;var botOption="general";var niua={success:false,firstname:"",lastname:"",country:"",language:"",email:"",profileId:"",company:"",phone:{countryCode:"",areaCode:"",phoneNumber:"",extension:""},role:"",localizedName:"",communityUsername:""};var sixSenseData={company:{domain:"",name:"",region:"",country:"",state:"",city:"",industry:"",industries:"",address:"",zip:"",phone:"",annual_revenue:"",is_blacklisted:"",state_code:""},confidence:""};var getCookie=function(cname){var name=cname+"=";var decodedCookie=decodeURIComponent(document.cookie);var ca=decodedCookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" "){c=c.substring(1)}if(c.indexOf(name)==0){return c.substring(name.length,c.length)}}return null};var messageListener=function(e){if(e.data&&typeof e.data==="object"){if(e.data.method&&e.data.method==="liveagent.initialized"){NIAnalytics.captureNavigation({eventName:"chat",eventLabel:"start chatting"});NIAnalytics.captureOutcome({eventName:"chat",eventAction:"start"});document.cookie="chatbotOption="+botOption+";domain=.ni.com;path=/"}if(e.data.data&&typeof e.data.data==="object"){if(Object.values(e.data.data).indexOf("ESW_IS_MINIMIZED")!=-1&&!chatHasEnded){NIAnalytics.captureNavigation({eventName:"chat",eventLabel:"info form close"})}if(e.data.data.event){if(e.data.data.event==="chasitorChatRequestSuccessful"){sessionStorage.setItem("chatbotEmail",niua.email)}if(e.data.data.event==="chasitorChasitorChatEnded"){chatHasEnded=true;NIAnalytics.captureNavigation({eventName:"chat",eventLabel:"chat close"});NIAnalytics.captureOutcome({eventName:"chat",eventAction:"complete",email:sessionStorage.getItem("chatbotEmail")})}if(e.data.data.event==="chatbotEndedChat"){chatHasEnded=true;NIAnalytics.captureNavigation({eventName:"chat",eventLabel:"chat ended by bot"});NIAnalytics.captureOutcome({eventName:"chat",eventAction:"complete",email:sessionStorage.getItem("chatbotEmail")})}if(e.data.data.event==="chasitorAgentChatEnded"){chatHasEnded=true;NIAnalytics.captureNavigation({eventName:"chat",eventLabel:"chat ended by agent"});NIAnalytics.captureOutcome({eventName:"chat",eventAction:"complete",email:sessionStorage.getItem("chatbotEmail")})}}if(e.data.data.params&&e.data.data.params.getContent){if(botOption==="cart"||botOption==="shipping"||botOption==="payment"){if(e.data.data.params.getContent==="Orders and shipping"){NIAnalytics.captureNavigation({eventName:"chat",eventLabel:"Orders and shipping"})}else if(e.data.data.params.getContent==="Payment and taxes"){NIAnalytics.captureNavigation({eventName:"chat",eventLabel:"Payment and taxes"})}else if(e.data.data.params.getContent==="Product selection"){NIAnalytics.captureNavigation({eventName:"chat",eventLabel:"Product selection"})}else if(e.data.data.params.getContent==="Quote help"){NIAnalytics.captureNavigation({eventName:"chat",eventLabel:"Quote help"})}else if(e.data.data.params.getContent==="Website help"){NIAnalytics.captureNavigation({eventName:"chat",eventLabel:"Website help"})}else if(e.data.data.params.getContent==="Something else"){NIAnalytics.captureNavigation({eventName:"chat",eventLabel:"Something else"})}else if(e.data.data.params.getContent==="Chat with an expert"){NIAnalytics.captureNavigation({eventName:"chat",eventLabel:"Chat with an expert"})}else if(e.data.data.params.getContent==="Request offline follow-up"){NIAnalytics.captureNavigation({eventName:"chat",eventLabel:"Request offline follow-up"})}}if(botOption==="myaccount"||botOption==="orderstatus"){if(e.data.data.params.getContent==="Create a new quote or order"){NIAnalytics.captureNavigation({eventName:"chat",eventLabel:"create quote or order"})}else if(e.data.data.params.getContent==="Track or modify my order"){NIAnalytics.captureNavigation({eventName:"chat",eventLabel:"track order"})}else if(e.data.data.params.getContent==="Manage my products and services"){NIAnalytics.captureNavigation({eventName:"chat",eventLabel:"manage products"})}else if(e.data.data.params.getContent==="Configure my account"){NIAnalytics.captureNavigation({eventName:"chat",eventLabel:"configure account"})}else if(e.data.data.params.getContent==="Something else"){NIAnalytics.captureNavigation({eventName:"chat",eventLabel:"something else"})}}}if(chatHasEnded){deleteChatButton(10)}}}};var chatOpenListener=function(e){if(chatbotButton.querySelector(".helpButtonEnabled")){NIAnalytics.captureNavigation({eventName:"chat",eventLabel:"chat open"})}};var chatOpenAndStartListener=function(e){if(chatbotButton.querySelector(".helpButtonEnabled")){NIAnalytics.captureNavigation({eventName:"chat",eventLabel:"chat open"});NIAnalytics.captureNavigation({eventName:"chat",eventLabel:"start chatting"});NIAnalytics.captureOutcome({eventName:"chat",eventAction:"start"})}};var initESW=function(gslbBaseURL,displayHelpButton){embedded_svc.settings.extraPrechatInfo=[{entityFieldMaps:[{doCreate:false,doFind:true,fieldName:"LastName",isExactMatch:true,label:"Last Name"},{doCreate:false,doFind:true,fieldName:"FirstName",isExactMatch:true,label:"First Name"},{doCreate:false,doFind:true,fieldName:"Email",isExactMatch:true,label:"Email"}],entityName:"Contact",saveToTranscript:"Contact",showOnCreate:true}];embedded_svc.settings.disabledMinimizedText="Chat offline";embedded_svc.settings.defaultMinimizedText="Chat with an expert";embedded_svc.settings.displayHelpButton=true;embedded_svc.settings.language="";embedded_svc.settings.chatbotAvatarImgURL="https://www"+environment+".ni.com/images/chat/in-chat-avatar.png";embedded_svc.settings.avatarImgURL="https://www"+environment+".ni.com/images/chat/liveAgent.png";embedded_svc.settings.enabledFeatures=["LiveAgent"];embedded_svc.settings.entryFeature="LiveAgent";embedded_svc.settings.storageDomain="ni.com";var sixSenseData=get6senseData();chatbotNIUA.ready().then(function(){getNIUAData().then(function(){embedded_svc.settings.prepopulatedPrechatFields={Email:niua.email,FirstName:niua.firstname,LastName:niua.lastname,ProfileId:niua.profileId};embedded_svc.settings.extraPrechatFormDetails=[{label:"First Name",value:niua.firstname,transcriptFields:["FirstName__c"]},{label:"Last Name",value:niua.lastname,transcriptFields:["LastName__c"]},{label:"ChatRequestPage",value:botOption,displayToAgent:true,transcriptFields:["ChatRequestPage__c"]},{label:"Email",value:niua.email,transcriptFields:["Email__c"]},{label:"ProfileId",value:niua.profileId,displayToAgent:true,transcriptFields:["ProfileId__c"]},{label:"Country",value:niua.country,displayToAgent:true,transcriptFields:["Country__c"]},{label:"Language",value:niua.language,displayToAgent:true,transcriptFields:["Language__c"]},{label:"Company",value:niua.company,displayToAgent:true,transcriptFields:["Company__c"]},{label:"Phone Country Code",value:niua.phone.countryCode,displayToAgent:true,transcriptFields:["PhoneCountryCode__c"]},{label:"Phone Area Code",value:niua.phone.areaCode,displayToAgent:true,transcriptFields:["PhoneAreaCode__c"]},{label:"Phone Number",value:niua.phone.phoneNumber,displayToAgent:true,transcriptFields:["PhoneNumber__c"]},{label:"Phone Extension",value:niua.phone.extension,displayToAgent:true,transcriptFields:["PhoneExtension__c"]},{label:"Role",value:niua.role,displayToAgent:true,transcriptFields:["Role__c"]},{label:"Localized Name",value:niua.localizedName,displayToAgent:true,transcriptFields:["LocalizedName__c"]},{label:"Community Username",value:niua.communityUsername,displayToAgent:true,transcriptFields:["CommunityUsername__c"]},{value:sixSenseData.company.domain,displayToAgent:true,transcriptFields:["sixsense_company_domain__c"]},{value:sixSenseData.company.name,displayToAgent:true,transcriptFields:["sixsense_company_name__c"]},{value:sixSenseData.company.region,displayToAgent:true,transcriptFields:["sixsense_company_region__c"]},{value:sixSenseData.company.country,displayToAgent:true,transcriptFields:["sixsense_company_country__c"]},{value:sixSenseData.company.state,displayToAgent:true,transcriptFields:["sixsense_company_state__c"]},{value:sixSenseData.company.city,displayToAgent:true,transcriptFields:["sixsense_company_city__c"]},{value:sixSenseData.company.industry,displayToAgent:true,transcriptFields:["sixsense_company_industry__c"]},{value:sixSenseData.company.address,displayToAgent:true,transcriptFields:["sixsense_company_address__c"]},{value:sixSenseData.company.zip,displayToAgent:true,transcriptFields:["sixsense_company_zip__c"]},{value:sixSenseData.company.phone,displayToAgent:true,transcriptFields:["sixsense_company_phone__c"]},{value:sixSenseData.company.annual_revenue,displayToAgent:true,transcriptFields:["sixsense_company_annual_revenue__c"]},{value:sixSenseData.company.is_blacklisted,displayToAgent:true,transcriptFields:["sixsense_company_is_blacklisted__c"]},{value:sixSenseData.company.state_code,displayToAgent:true,transcriptFields:["sixsense_company_state_code__c"]},{value:sixSenseData.company.industries,displayToAgent:true,transcriptFields:["sixsense_company_industries__c"]},{value:sixSenseData.confidence,displayToAgent:true,transcriptFields:["sixsense_data_confidence__c"]}];startChat(gslbBaseURL)}).catch(function(error){console.log("Error while getting NIUA data.");startChat(gslbBaseURL)})}).catch(function(error){console.log("Error while getting NIUA data.");startChat(gslbBaseURL)})};var get6senseData=function(){var sixSenseStorageData=JSON.parse(localStorage.getItem("_6senseCompanyDetails"));if(!sixSenseStorageData){sixSenseStorageData=JSON.parse(sessionStorage.getItem("_6senseCompanyDetails"))}if(sixSenseStorageData){var industries="";if(sixSenseStorageData.company.industry_v2 instanceof Array){sixSenseStorageData.company.industry_v2.forEach(function(industryObject){industries=industries.concat(industryObject.industry,", ")})}sixSenseData.company=sixSenseStorageData.company;sixSenseData.company.industries=industries;sixSenseData.scores=sixSenseStorageData.scores;sixSenseData.segments=sixSenseStorageData.segments;sixSenseData.confidence=sixSenseStorageData.confidence}return sixSenseData};var getNIUAData=function(){var promise=new Promise(function(resolve,reject){chatbotNIUA.getDetails().then(function(data){niua.success=data.response.success;if(data.response.success){niua.firstname=data.response.firstName;niua.lastname=data.response.lastName;niua.country=data.response.country;niua.language=data.response.language;niua.email=data.response.email;niua.profileId=data.response.profileId;niua.company=data.response.company;niua.phone=data.response.phone;niua.role=data.response.role;niua.localizedName=data.response.localizedName;niua.communityUsername=data.response.communityUsername}resolve()}).catch(function(error){console.log("Error while getting NIUA data.");niua.success=false;reject()})});return promise};var setupBotOption=function(){if(chatbotPageLocale==="en-US"||chatbotPageLocale==="en-CA"){if(getCookie("chatbotOption")){botOption=getCookie("chatbotOption");chatLoadedFromCookie=true}else if(botLocation.match("/shop/cart")){botOption="cart"}else if(botLocation.match("/webapp/wcs/stores/servlet/ordershipping")){botOption="shipping"}else if(botLocation.match("/webapp/wcs/stores/servlet/orderbilling")){botOption="payment"}else if(botLocation.match("^/[-a-z]+/myni/*")||botLocation.match("^/myni/*")){botOption="myaccount"}else if(botLocation.match("^/status/*")){botOption="orderstatus"}}};var deleteChatButton=function(minutes){document.cookie="chatbotOption=; domain=.ni.com ;expires=Thu, 01 Jan 1070 00:00:01 GMT; path=/;";if(chatLoadedFromCookie){var refreshId=setTimeout(function(){if(getCookie("chatbotOption")==null){chatbotButton=document.getElementsByClassName("helpButton")[0];if(chatbotButton){chatbotButton.style.display="none";clearInterval(refreshId)}}},minutes*6e4)}};var startChat=function(gslbBaseURL){embedded_svc.init(sfdcURL,sfdcCommunityURL,gslbBaseURL,sfdcEmbeddedId,sfdcEmbeddedDeploymentName,{baseLiveAgentContentURL:sfdcBaseLiveAgentContentURL,deploymentId:sfdcDeploymentId,buttonId:sfdcButtonId,baseLiveAgentURL:sfdcBaseLiveAgentURL,eswLiveAgentDevName:sfdcEswLiveAgentDevName,isOfflineSupportEnabled:false})};var initChat=function(){if(document.cookie.includes("locale")){chatbotPageLocale=getCookie("locale")}setupBotOption();let body=document.getElementsByTagName("body")[0];let chatStyleLink=document.createElement("link");chatStyleLink.rel="stylesheet";chatStyleLink.type="text/css";if(botOption==="myaccount"||botOption==="orderstatus"){sfdcEmbeddedDeploymentName="My_Account_and_Order_Status";sfdcEswLiveAgentDevName="EmbeddedServiceLiveAgent_Parent04I0v000000Cac0EAC_178b7a7af52";sfdcDeploymentId="5723q0000002cfh";sfdcButtonId="5733q0000002g2i"}else if(botOption==="cart"||botOption==="payment"||botOption==="shipping"){sfdcEmbeddedDeploymentName="NI_Website_chatbot";sfdcDeploymentId="5723q0000002cfX";sfdcButtonId="5733q0000002g2Y";sfdcEswLiveAgentDevName="NI_chat_team";chatStyleLink.href="https://www"+environment+".ni.com/css/sfdc/NationalInstrumentCartBot.css";body.appendChild(chatStyleLink)}embedded_svc.addEventHandler("afterDestroy",function(data){deleteChatButton(10)});embedded_svc.addEventHandler("onIdleTimeoutOccurred",function(data){deleteChatButton(10)});embedded_svc.addEventHandler("onChatConferenceEnded",function(data){deleteChatButton(10)});embedded_svc.addEventHandler("onChatEndedByChasitor",function(data){deleteChatButton(10)});embedded_svc.addEventHandler("onChatEndedByAgent",function(data){deleteChatButton(10)});if(botOption!="general"&&botOption){if(!window.embedded_svc){var s=document.createElement("script");s.setAttribute("src",sfdcEmbeddedServiceSourceURL);s.onload=function(){initESW(null)};document.body.appendChild(s)}else{initESW("https://service.force.com")}addEventListener("message",messageListener,false);addEventListener("click",messageListener,false);var refreshId=setInterval(function(){chatbotButton=document.getElementsByClassName("helpButton")[0];if(chatbotButton){if(botOption==="cart"||botOption==="shipping"||botOption==="payment"){chatbotButton.addEventListener("click",chatOpenAndStartListener,false)}else{chatbotButton.addEventListener("click",chatOpenListener,false)}if(chatLoadedFromCookie){if(typeof embedded_svc.liveAgentAPI.browserSessionInfo.activeChatSessions==="undefined"){deleteChatButton(.1)}}clearInterval(refreshId)}},500)}};initChat();